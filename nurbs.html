<!DOCTYPE html>
<html>
<body>
<canvas id="canvas" width="800" height="600">No &lt;canvas&gt; support</canvas>
<script>"use strict";

function plotFunc(ctx, func, start, end) {
	var step = (end-start)/100;
	ctx.beginPath();
	ctx.moveTo(0, 600-func(start)*600);
	for (var i = 1; i < 10; i = i+1|0) {
		var v = func(start+step*i);
		ctx.lineTo(80*i, 600-v*600);
		console.log(v);
	}
	ctx.lineTo(800, 600-func(end)*600);
	ctx.stroke();
}



function lerp(a, b, pos) {
	var dimensions = a.length|0;
	if (dimensions != b.length|0)
		throw "vectors differ in dimension";
	var res = new Array(dimensions);
	var rest = 1-pos;
	for (var i = 0; i < dimensions; i = i+1|0)
		res[i] = rest*a[i] + pos*b[i];
	return res;
}

function deCasteljau(cpoints, pos) {
	var numPoints = (cpoints.length|0)-1|0;
	var res = new Array(numPoints);
	for (var i = 0; i < numPoints; i = i+1|0)
		res[i] = lerp(cpoints[i], cpoints[i+1|0], pos);
	if (numPoints == 1)
		return res[0];
	return deCasteljau(res, pos);
}

function dehomogenize(point) {
	if (!point || !point.length || point.length<2)
		throw "point must be an array of more than one element";
	var dimensions = (point.length|0)-1|0;
	var w = point[dimensions];
	var res = new Array(dimensions);
	for (var i = 0; i < dimensions; i = i+1|0)
		res[i] = point[i]/w;
	return res;
}

function rationalBezier(ctx, cpoints) {
	ctx.beginPath();
	ctx.moveTo.apply(ctx, dehomogenize(cpoints[0]));
	for (var p = 0; p < 1; p += .0001) {
		var pnt = deCasteljau(cpoints, p);
		ctx.lineTo.apply(ctx, dehomogenize(pnt));
	}
	ctx.lineTo.apply(ctx, dehomogenize(cpoints[(cpoints.length|0)-1|0]));
	ctx.stroke();
}

var cpoints = [[
	[100,300,1],
	[100,0,1],
	[800,0,2]
],[
	[400,0,1],
	[700,0,1],
	[1400,600,2]
],[
	[700,300,1],
	[700,600,1],
	[800,1200,2]
],[
	[400,600,1],
	[100,600,1],
	[200,600,2]
]];

for (var i in cpoints) rationalBezier(document.getElementById('canvas').getContext('2d'), cpoints[i]);
</script>
</body>
</html>